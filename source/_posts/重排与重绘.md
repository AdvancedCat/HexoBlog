---
title: 重排与重绘
date: 2017-12-19 10:34:13
tags:
---

# 重排重绘？
当浏览器将静态资源（一般指css、js和字体）加载完成后，会维护两个内部数据结构————**DOM树** 和 **渲染树**。

DOM树和渲染树合并为一个DOM渲染树，DOM渲染树上标记每个DOM的外观和位置属性，浏览器依据这棵树计算出每个DOM的位置大小外观等信息，之后依照这些信息将节点绘制在页面中。

隐藏的DOM不会出现在DOM渲染树中，浏览器不会去渲染它。

由于浏览器的流布局，对渲染树的计算通常只需要遍历一次就可以完成。但table及其内部元素除外，它可能需要多次计算才能确定好其在渲染树中节点的属性，通常要花3倍于同等元素的时间。这也是为什么我们要避免使用table做布局的一个原因。

在CSS中，我们知道每个节点都是一个盒模型，无论通过css或者js改变了这个盒子的属性，都会导致盒子的状态发生变化。浏览器检测到盒子变化后，就会将这种变化即使反应到页面中，一般现代浏览器都比较聪明，会将若干次的变化合并为一次来改变页面。
触发这种页面变化的就是重排和重绘。

**重绘** ： 是一个元素外观的改变所触发的浏览器行为，例如改变visibility、outline、背景色等属性。浏览器会根据元素的新属性重新绘制，使元素呈现新的外观。重绘不会带来重新布局，并不一定伴随重排。

**重排** ： 当DOM的变化影响了元素的几何属性（宽或高），浏览器需要重新计算元素的几何属性，同样其他元素的几何属性和位置也会因此受到影响。浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。这个过程称为重排。重排一定伴随着重绘。

从上面得知，重排必定会触发重绘，因此减少重排的次数可以有效提高浏览器效率。

# 影响重排的操作
当DOM的几何因素发生变化时，就会触发重排，DOM几何变化有以下几种：
1. DOM的`width,height,padding,border,margin,line-height`属性发生变化时，都会发生重排。如果DOM的其他属性的变化使得它的位置和大小也发生了变化，如调整字体大小因此高度变化，必定也会发生重排。DOM的动画也会影响重排。
2. DOM树的结构发生变化，这个肯定是触发重排的，没得商量。
3. 浏览器大小发生变化。浏览器的resize会影响到页面内容的布局。

# 提高浏览器效率
为了能让浏览器更快的显示页面，一般做到尽量减少重绘次数、减少重排次数、缩小重排的影响范围
1. 合并多次操作
```js
ele.style.cssText = 'margin-top:20px;padding: 0 10px;'
```
2. 如果某个dom频繁触发重排，将它设置为`absolute或fixed或float`,这样它脱离了文档流，尽可能减少它对其他dom的影响。例如动画类的dom使用绝对定位是最好的。
3. 由于隐藏的元素不在DOM渲染树中，因此针对频繁更新位置和外观的DOM，可以先将它隐藏，之后完成更新后，再显示出来。这样仅触发两次重排。但这个方式有个缺点，会导致页面的忽闪。
4. 在内存中多次操作节点，完成后再添加到文档中去（可使用fragment元素）。例如要异步获取表格数据，渲染到页面。可以先取得数据后在内存中构建整个表格的html片段，再一次性添加到文档中去，而不是循环添加每一行。


那么问题来了，如果面试官问你“如何给一个大量数据的表格排序”，你要怎么回答？
